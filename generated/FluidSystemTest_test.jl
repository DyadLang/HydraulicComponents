### DO NOT EDIT THIS FILE
### This file is auto-generated by the Dyad command-line compiler.
### If you edit this code it is likely to get overwritten.
### Instead, update the Dyad source code and regenerate this file


@testset "Running test case1 for FluidSystemTest" begin
  using CSV, DataFrames, Plots

  @mtkbuild model = FluidSystemTest()
  u0 = []
  prob = ODEProblem(model, u0, (0, 2))
  sol = solve(prob, DefaultODEAlgorithm())
  @test SciMLBase.successful_retcode(sol)
# Signals selected for regression testing: ["vol.rho","vol.port.p","tube.m_flow"]
  ref_times = [sol(t, idxs=:t) for t in LinRange(sol[:t][1], sol[:t][end], 100)]
  if get(ENV, "DYAD_UPDATE_REFS", "") !== ""
    # If asked to update snapshots, write out reference data for all signals
    mkpath("snapshots")
    CSV.write("snapshots/FluidSystemTest_case1_sig0.ref", DataFrame(t=ref_times, expected=[sol(t, idxs=model.vol.rho) for t in ref_times]))
    CSV.write("snapshots/FluidSystemTest_case1_sig1.ref", DataFrame(t=ref_times, expected=[sol(t, idxs=model.vol.port.p) for t in ref_times]))
    CSV.write("snapshots/FluidSystemTest_case1_sig2.ref", DataFrame(t=ref_times, expected=[sol(t, idxs=model.tube.m_flow) for t in ref_times]))
  end
    if isfile("snapshots/FluidSystemTest_case1_sig0.ref")
      ref = CSV.read("snapshots/FluidSystemTest_case1_sig0.ref", DataFrame)
      [@test ref.expected[i] ≈ sol(ref.t[i], idxs=model.vol.rho) atol=0.001 for i in 1:length(ref.expected)]
      if get(ENV, "DYAD_COMPARISONS", "") !== ""
        df = DataFrame(t=sol[:t], actual=sol[model.vol.rho])
        dfr = CSV.read("snapshots/FluidSystemTest_case1_sig0.ref", DataFrame)
        plot(sol, idxs=[model.vol.rho], width=2, label="Actual value of vol.rho")
        scatter!(dfr.t, dfr.expected, mc=:red, ms=3, label="Expected value of vol.rho")
        mkpath("comparisons")
        savefig("comparisons/FluidSystemTest_case1_sig0.png")
      end
    else
      mkpath("snapshots")
      CSV.write("snapshots/FluidSystemTest_case1_sig0.ref", DataFrame(t=ref_times, expected=[sol(t, idxs=model.vol.rho) for t in ref_times]))
    end
    if isfile("snapshots/FluidSystemTest_case1_sig1.ref")
      ref = CSV.read("snapshots/FluidSystemTest_case1_sig1.ref", DataFrame)
      [@test ref.expected[i] ≈ sol(ref.t[i], idxs=model.vol.port.p) atol=1 for i in 1:length(ref.expected)]
      if get(ENV, "DYAD_COMPARISONS", "") !== ""
        df = DataFrame(t=sol[:t], actual=sol[model.vol.port.p])
        dfr = CSV.read("snapshots/FluidSystemTest_case1_sig1.ref", DataFrame)
        plot(sol, idxs=[model.vol.port.p], width=2, label="Actual value of vol.port.p")
        scatter!(dfr.t, dfr.expected, mc=:red, ms=3, label="Expected value of vol.port.p")
        mkpath("comparisons")
        savefig("comparisons/FluidSystemTest_case1_sig1.png")
      end
    else
      mkpath("snapshots")
      CSV.write("snapshots/FluidSystemTest_case1_sig1.ref", DataFrame(t=ref_times, expected=[sol(t, idxs=model.vol.port.p) for t in ref_times]))
    end
    if isfile("snapshots/FluidSystemTest_case1_sig2.ref")
      ref = CSV.read("snapshots/FluidSystemTest_case1_sig2.ref", DataFrame)
      [@test ref.expected[i] ≈ sol(ref.t[i], idxs=model.tube.m_flow) atol=0.001 for i in 1:length(ref.expected)]
      if get(ENV, "DYAD_COMPARISONS", "") !== ""
        df = DataFrame(t=sol[:t], actual=sol[model.tube.m_flow])
        dfr = CSV.read("snapshots/FluidSystemTest_case1_sig2.ref", DataFrame)
        plot(sol, idxs=[model.tube.m_flow], width=2, label="Actual value of tube.m_flow")
        scatter!(dfr.t, dfr.expected, mc=:red, ms=3, label="Expected value of tube.m_flow")
        mkpath("comparisons")
        savefig("comparisons/FluidSystemTest_case1_sig2.png")
      end
    else
      mkpath("snapshots")
      CSV.write("snapshots/FluidSystemTest_case1_sig2.ref", DataFrame(t=ref_times, expected=[sol(t, idxs=model.tube.m_flow) for t in ref_times]))
    end
end
